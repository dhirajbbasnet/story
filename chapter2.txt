This is chapter 2 modified on different branch.